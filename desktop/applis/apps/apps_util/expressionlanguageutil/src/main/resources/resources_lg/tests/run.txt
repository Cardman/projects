
{public} {abstract} {final} {class} {Execute}'{'
    {public} {static} {Table}<{Method},{Result}> {tests}({InfoTest} {info})'{'
        {Table}<{Class},{List}<{ExecutedTest}>> {out} = {new} {Table}<>(){endLine}
        {var} {t} = {cast}({long})0{endLine}
        {for} ({var} {c}: {static}({Class}).{getAllClasses}())'{'
            {List}<{Method}> {bs} = {new} {List}<>(){endLine}
            {List}<{Method}> {as} = {new} {List}<>(){endLine}
            {List}<{ExecutedTest}> {tts} = {new} {List}<>(){endLine}
            {for} ({var} {m}: ({c}{loop}).{getDeclaredMethods}())'{'
                {var} {e} = {new} {ExecutedTest}(){endLine}
                {var} {a} = ({m}{loop}).{getAnnotations}({class}({Test})){endLine}
                {if} ({static}({ObjectsUtil}).{eq}(({a}).{length}, 1) && !{static}({ObjectsUtil}).{eq}(({cast}({Test}){a}[0]).{exception}(), {class}({Difference})))'{'
                    ({e}{local}).{test} = {m}{loop}{endLine}
                    ({e}{local}).{annotations} = {a}{local}{endLine}
                    ({e}{local}).{before} = {bs}{local}{endLine}
                    ({e}{local}).{after} = {as}{local}{endLine}
                    {var} {aParam} = ({m}{loop}).{getAnnotations}({class}({Parameters})){endLine}
                    {if} ({static}({ObjectsUtil}).{eq}(({aParam}{local}).{length}, 1))'{'
                        {var} {paramAnn} = {cast}({Parameters}){aParam}{local}[0]{endLine}
                        {var} {loc} = ({paramAnn}{local}).{methodParam}(){endLine}
                        {var} {locType} = ({paramAnn}{local}).{location}(){endLine}
                        {if} ({static}({ObjectsUtil}).{eq}({locType}{local},{null}))'{'
                            {locType}{local} = {c}{loop}{endLine}
                        '}'
                        {for} ({var} {p}: ({locType}{local}).{getDeclaredMethods}())'{'
                            {if} (!{static}({ObjectsUtil}).{eq}(({p}{loop}).{getMethodName}(), {loc}{local}))'{'
                                {continue}{endLine}
                            '}'
                            {if} (!({p}{loop}).{isStatic}())'{'
                                {continue}{endLine}
                            '}'
                            {if} (!{static}({ObjectsUtil}).{eq}(({p}{loop}).{getParameterTypes}().{length},0))'{'
                                {continue}{endLine}
                            '}'
                            ({e}{local}).{method} = {p}{endLine}
                            {break}{endLine}
                        '}'
                    '}'
                    {t}{local} = {static}({Math}).{plus}({t}{local},1){endLine}
                    ({tts}{local}).{add}({e}{local}){endLine}
                '}'
                {if} ({static}({Math}).{gt}(({m}{loop}).{getAnnotations}({class}({Before})).{length},0))'{'
                    ({bs}{local}).{add}({m}{loop}){endLine}
                '}'
                {if} ({static}({Math}).{gt}(({m}{loop}).{getAnnotations}({class}({After})).{length},0))'{'
                    ({as}{local}).{add}({m}{loop}){endLine}
                '}'
            '}'
            {if} ({static}({Math}).{gt}(({tts}{local}).{sizeLi}(),0))'{'
                ({out}{local}).{addTa}({c}{loop},{tts}{local}){endLine}
            '}'
        '}'
        ({info}{param}).{count} = {t}{local}{endLine}

        {Table}<{Method},{Result}> {results} = {new} {Table}<>(){endLine}

        {for} ({var} {c}, {var} {l}: {out}{local})'{'
            {for} ({var} {e}: {l}{loop})'{'
                {var} {tt} = ({e}{loop}).{test}{endLine}
                ({info}{param}).{currentMethod} = {tt}{local}{endLine}
                {if} (!{static}({ObjectsUtil}).{eq}(({e}{loop}).{method},{null}))'{'
                    {Object} {arr} = {null}{endLine}
                    {Object} {exc} = {null}{endLine}
                    {try} '{'
                        {arr}{local} = ({e}{loop}).{method}.{invoke}({null}){endLine}
                    '}' {catch} ({InvokeTarget} {o})'{'
                        {exc}{local} = ({o}{cv}).{getCause}(){endLine}
                    '}'
                    {if} ({arr}{local} {instanceof} {Object}[][])'{'
                        {for} ({var} {p}: {cast}({Object}[][]){arr})'{'
                            {var} {params} = {new} {StringBuilder}(){endLine}
                            {var} {nbParams} = ({p}{loop}).{length}{endLine}
                            {for} ({var} {i} = 0{endLine} {static}({Math}).{lt}({i}{loop}, {static}({Math}).{minus}({nbParams}{local},1)){endLine} {i}{loop}={static}({Math}).{plus}({i}{loop},1))'{'
                                ({params}{local}).{append}({convert}({p}{loop}[{i}{loop}])).{append}(","){endLine}
                            '}'
                            {if} ({static}({Math}).{gt}({nbParams}{local},0))'{'
                                ({params}{local}).{append}({convert}({p}{loop}[{static}({Math}).{minus}({nbParams}{local},1)])){endLine}
                            '}'
                            ({info}{param}).{currentParams} = ({params}{local}).{toString}(){endLine}
                            {var} {res} = {execute}({e}{loop},{c}{loop},{p}{loop}){endLine}
                            ({res}{local}).{pf} = ({params}{local}).{toString}(){endLine}
                            ({results}{local}).{addTa}({tt}{local},{res}{local}){endLine}
                        '}'
                    '}' {else} '{'
                        ({results}{local}).{addTa}({tt}{local},{setupError}({e}{loop},{exc}{local})){endLine}
                    '}'
                '}' {else} '{'
                    ({results}{local}).{addTa}({tt}{local},{execute}({e}{loop},{c}{loop},{new} {Object}[]'{''}')){endLine}
                '}'
                ({info}{param}).{done} = {static}({Math}).{plus}(({info}{param}).{done},1){endLine}
            '}'

        '}'

        {static}({Thread}).{joinOthers}(){endLine}
        {return} {results}{local}{endLine}
    '}'
    {private} {static} {Result} {execute}({ExecutedTest} {r1},{Class} {r2},{Object}[] {r3})'{'
        {var} {processEx} = {false}{endLine}
        {try} '{'
            {var} {ctor} = ({r2}{param}).{getDeclaredConstructors}({false})[0]{endLine}
            {processEx}{local} = {true}{endLine}
            {var} {classTest} = ({ctor}{local}).{newInstance}(){endLine}
            {for} ({var} {b}: ({r1}{param}).{before})'{'
                ({b}{loop}).{invoke}({classTest}{local}){endLine}
            '}'
            ({r1}{param}).{test}.{invoke}({classTest}{local}, {r3}{param}){endLine}
            {for} ({var} {b}: ({r1}{param}).{after})'{'
                ({b}{loop}).{invoke}({classTest}{local}){endLine}
            '}'
            {return} {setupNoException}({r1}{param}){endLine}
        '}' {catch} ({InvokeTarget} {o})'{'
            {return} {setupError}({r1}{param},{o}{cv},{processEx}{local}){endLine}
        '}' {catch} ({Object} {o})'{'
            {return} {setupError}({r1}{param},{o}{cv}){endLine}
        '}'
    '}'
    {private} {static} {String} {convert}({Object} {co})'{'
        {try} '{'
            {return} {static}({StringUtil}).{valueOf}({co}{param}){endLine}
        '}' {catch} ({Object} {e})'{'
            {return} {static}({Class}).{getClass}({co}{param}).{getClassName}(){endLine}
        '}' {catch} '{'
            {return} {static}({Class}).{getClass}({co}{param}).{getClassName}(){endLine}
        '}'
    '}'
    {private} {static} {Result} {setupNoException}({ExecutedTest} {et1})'{'
        {var} {res} = {new} {Result}(){endLine}
        {var} {tt} = {cast}({Test})({et1}{param}).{annotations}[0]{endLine}
        {if} (({tt}{local}).{nullException}())'{'
            ({res}{local}).{success} = {false}{endLine}
            ({res}{local}).{failMessage} = {new} {StringBuilder}("!=").{append}({static}({StringUtil}).{valueOf}({null})).{toString}(){endLine}
        '}' {else} {if} (!{static}({ObjectsUtil}).{eq}(({tt}{local}).{exception}(),{null}))'{'
            ({res}{local}).{success} = {false}{endLine}
            ({res}{local}).{failMessage} = {new} {StringBuilder}("!=").{append}(({tt}{local}).{exception}().{getClassName}()).{toString}(){endLine}
        '}'
        {return} {res}{local}{endLine}
    '}'
    {private} {static} {Result} {setupError}({ExecutedTest} {et2}, {InvokeTarget} {et3}, {boolean} {et4})'{'
        {var} {res} = {new} {Result}(){endLine}
        {var} {ex} = ({et3}{param}).{getCause}(){endLine}
        {if} ({et4}{param}) '{'
            {var} {tt} = {cast}({Test})({et2}{param}).{annotations}[0]{endLine}
            {if} (({tt}{local}).{nullException}())'{'
                {if} (!{static}({ObjectsUtil}).{eq}({ex}{local},{null}))'{'
                    ({res}{local}).{success} = {false}{endLine}
                    ({res}{local}).{failMessage} = {static}({StringUtil}).{valueOf}({ex}{local}){endLine}
                '}'
            '}' {else} {if} (!{static}({ObjectsUtil}).{eq}(({tt}{local}).{exception}(),{null})) '{'
                {if} (!({tt}{local}).{exception}().{isAssignableFrom}({static}({Class}).{getClass}({ex}{local})))'{'
                    ({res}{local}).{success} = {false}{endLine}
                    ({res}{local}).{failMessage} = {static}({StringUtil}).{valueOf}({ex}{local}){endLine}
                '}'
            '}' {else} '{'
                ({res}{local}).{success} = {false}{endLine}
                ({res}{local}).{failMessage} = {static}({StringUtil}).{valueOf}({ex}{local}){endLine}
            '}'
        '}' {else} '{'
            ({res}{local}).{success} = {false}{endLine}
            ({res}{local}).{failMessage} = {static}({StringUtil}).{valueOf}({ex}{local}){endLine}
        '}'
        {return} {res}{endLine}
    '}'
    {private} {static} {Result} {setupError}({ExecutedTest} {et}, {Object} {er})'{'
        {var} {res} = {new} {Result}(){endLine}
        ({res}{local}).{success} = {false}{endLine}
        ({res}{local}).{failMessage} = {static}({StringUtil}).{valueOf}({er}{param}){endLine}
        {return} {res}{endLine}
    '}'
'}'

{public} {class} {InfoTest}'{'
    {public} {long} {count}{endLine}
    {public} {long} {done}{endLine}
    {public} {Method} {currentMethod}{endLine}
    {public} {String} {currentParams}{endLine}

'}'

{public} {class} {Result}'{'
    {public} {boolean} {success} = {true}{endLine}
    {public} {String} {pf} = ""{endLine}
    {public} {String} {failMessage} = ""{endLine}
'}'

{public} {class} {ExecutedTest}'{'
    {public} {List}<{Method}> {before}{endLine}
    {public} {Method} {test}{endLine}
    {public} {Annotation}[] {annotations}{endLine}
    {public} {List}<{Method}> {after}{endLine}
    {public} {Method} {method}{endLine}

'}'

{public} {annotation} {Before}'{''}'
{public} {annotation} {After}'{''}'
{public} {annotation} {Parameters}'{'
    {String} {methodParam}(){endLine}
    {Class} {location}(){null}{endLine}
'}'

{public} {annotation} {Test}'{'
    {Class} {exception}(){null}{endLine}
    {boolean} {nullException}(){false}{endLine}
'}'

{public} {abstract} {final} {class} {Assert}'{'

    {public} {static} {void} {assert}({long} {a11}, {long} {a12})'{'
        {if} (!{static}({ObjectsUtil}).{eq}({a11}{param}, {a12}{param}))'{'
            {var} {d} = {new} {Difference}(){endLine}
            ({d}{local}).{expected}={a11}{param}{endLine}
            ({d}{local}).{found}={a12}{param}{endLine}
            ({d}{local}).{stackDiff} = {static}({Stack}).{current}(){endLine}
            {throw} {d}{local}{endLine}
        '}'
    '}'

    {public} {static} {void} {assert}({double} {a21}, {double} {a22})'{'
        {if} (!{static}({ObjectsUtil}).{eq}({a21}{param}, {a22}{param}))'{'
            {var} {d} = {new} {Difference}(){endLine}
            ({d}{local}).{expected}={a21}{param}{endLine}
            ({d}{local}).{found}={a22}{param}{endLine}
            ({d}{local}).{stackDiff} = {static}({Stack}).{current}(){endLine}
            {throw} {d}{local}{endLine}
        '}'
    '}'

    {public} {static} {void} {assert}({String} {a31}, {String} {a32})'{'
        {if} (!{static}({ObjectsUtil}).{eq}({a31}{param}, {a32}{param}))'{'
            {var} {d} = {new} {Difference}(){endLine}
            ({d}{local}).{expected}={a31}{param}{endLine}
            ({d}{local}).{found}={a32}{param}{endLine}
            ({d}{local}).{stackDiff} = {static}({Stack}).{current}(){endLine}
            {throw} {d}{local}{endLine}
        '}'
    '}'
    {public} {static} {void} {assert}({StringBuilder} {a41}, {StringBuilder} {a42})'{'
        {if} (!{static}({ObjectsUtil}).{eq}({a41}{param}, {a42}{param}))'{'
            {var} {d} = {new} {Difference}(){endLine}
            ({d}{local}).{expected}={a41}{param}{endLine}
            ({d}{local}).{found}={a42}{param}{endLine}
            ({d}{local}).{stackDiff} = {static}({Stack}).{current}(){endLine}
            {throw} {d}{local}{endLine}
        '}'
    '}'
    {public} {static} {void} {assert}({boolean} {a51}, {boolean} {a52})'{'
        {if} (!{static}({ObjectsUtil}).{eq}({a51}{param}, {a52}{param}))'{'
            {var} {d} = {new} {Difference}(){endLine}
            ({d}{local}).{expected}={a51}{param}{endLine}
            ({d}{local}).{found}={a52}{param}{endLine}
            ({d}{local}).{stackDiff} = {static}({Stack}).{current}(){endLine}
            {throw} {d}{local}{endLine}
        '}'
    '}'
    {public} {static} {void} {assertTrue}({boolean} {a6})'{'
        {if} (!{a6}{param})'{'
            {var} {d} = {new} {Difference}(){endLine}
            ({d}{local}).{expected}={true}{endLine}
            ({d}{local}).{found}={false}{endLine}
            ({d}{local}).{stackDiff} = {static}({Stack}).{current}(){endLine}
            {throw} {d}{local}{endLine}
        '}'
    '}'
    {public} {static} {void} {assertFalse}({boolean} {a61})'{'
        {if} ({a61}{param})'{'
            {var} {d} = {new} {Difference}(){endLine}
            ({d}{local}).{expected}={false}{endLine}
            ({d}{local}).{found}={true}{endLine}
            ({d}{local}).{stackDiff} = {static}({Stack}).{current}(){endLine}
            {throw} {d}{local}{endLine}
        '}'
    '}'
    {public} {static} {void} {assertNull}({Object} {a7})'{'
        {if} (!{static}({ObjectsUtil}).{eq}({a7}{param}, {null}))'{'
            {var} {d} = {new} {Difference}(){endLine}
            ({d}{local}).{expected}={null}{endLine}
            ({d}{local}).{found}={a7}{param}{endLine}
            ({d}{local}).{stackDiff} = {static}({Stack}).{current}(){endLine}
            {throw} {d}{local}{endLine}
        '}'
    '}'
    {public} {static} {void} {assertNotNull}({Object} {a8})'{'
        {if} ({static}({ObjectsUtil}).{eq}({a8}{param}, {null}))'{'
            {var} {d} = {new} {Difference}(){endLine}
            ({d}{local}).{foundNull}={true}{endLine}
            ({d}{local}).{stackDiff} = {static}({Stack}).{current}(){endLine}
            {throw} {d}{local}{endLine}
        '}'
    '}'
    {public} {static} {void} {assertSame}({Object} {a91}, {Object} {a92})'{'
        {if} (!{static}({ObjectsUtil}).{eq}({a91}{param}, {a92}{param}))'{'
            {var} {d} = {new} {Difference}(){endLine}
            ({d}{local}).{expected}={a91}{param}{endLine}
            ({d}{local}).{found}={a92}{param}{endLine}
            ({d}{local}).{stackDiff} = {static}({Stack}).{current}(){endLine}
            {throw} {d}{local}{endLine}
        '}'
    '}'
    {public} {static} {void} {assert}({Object} {a101}, {Object} {a102}, {Fct}<?,?,{boolean}> {a103})'{'
        {if} (!({a103}{param}).{call}({a101}{param}, {a102}{param}))'{'
            {var} {d} = {new} {Difference}(){endLine}
            ({d}{local}).{expected}={a101}{param}{endLine}
            ({d}{local}).{found}={a102}{param}{endLine}
            ({d}{local}).{stackDiff} = {static}({Stack}).{current}(){endLine}
            {throw} {d}{local}{endLine}
        '}'
    '}'
    {public} {static} {void} {assert}({Object} {a111}, {Fct}<?,{boolean}> {a112})'{'
        {if} (!({a112}{param}).{call}({a111}{param}))'{'
            {var} {d} = {new} {Difference}(){endLine}
            ({d}{local}).{foundNotTrue}={true}{endLine}
            ({d}{local}).{found}={a111}{param}{endLine}
            ({d}{local}).{stackDiff} = {static}({Stack}).{current}(){endLine}
            {throw} {d}{local}{endLine}
        '}'
    '}'

'}'

{public} {class} {Difference}'{'
    {public} {Object} {expected}{endLine}
    {public} {Object} {found}{endLine}
    {public} {boolean} {foundNull}{endLine}
    {public} {boolean} {foundNotTrue}{endLine}
    {public} {Stack}[] {stackDiff}{endLine}

    {public} {String} {toSpecString}()'{'
        {var} {out} = {new} {StringBuilder}(){endLine}
        {for} ({var} {s}: {this}.{stackDiff})'{'
            ({out}{local}).{append}({static}({StringUtil}).{valueOf}({s}{loop})){endLine}
        '}'
        {if} ({this}.{foundNotTrue})'{'
            ({out}{local}).{insert}(0,"\n"){endLine}
            ({out}{local}).{insert}(0,{static}({StringUtil}).{valueOf}({this}.{found})){endLine}
            {return} ({out}{local}).{toString}(){endLine}
        '}'
        {if} ({this}.{foundNull})'{'
            ({out}{local}).{insert}(0,"\n"){endLine}
            ({out}{local}).{insert}(0,{static}({StringUtil}).{valueOf}({null})){endLine}
            {return} ({out}{local}).{toString}(){endLine}
        '}'
        ({out}{local}).{insert}(0,"\n"){endLine}
        ({out}{local}).{insert}(0,{static}({StringUtil}).{valueOf}({this}.{found})){endLine}
        ({out}{local}).{insert}(0,"!="){endLine}
        ({out}{local}).{insert}(0,{static}({StringUtil}).{valueOf}({this}.{expected})){endLine}
        {return} ({out}{local}).{toString}(){endLine}
    '}'
'}'